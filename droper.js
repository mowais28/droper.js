window.droper = { init: function (e, t = {}) { const n = "string" == typeof e ? document.querySelector(e) : e; if (!n || "file" !== n.type) return; const i = Object.assign({ maxFiles: 5, previewHeight: "160px", placeholder: "Click or drag files here to upload", existingFiles: [] }, t), r = document.createElement("div"); r.className = "droper-container border rounded my-2 bg-light text-center position-relative", r.style.cursor = "pointer", r.style.padding = "3rem"; const a = document.createElement("p"); a.className = "text-muted mb-0", a.innerText = i.placeholder, r.appendChild(a); const o = document.createElement("div"); o.classList.add("droper-preview", "row", "mt-3"), r.appendChild(o), n.hidden = !0, n.parentNode.insertBefore(r, n), r.appendChild(n); let l = [], d = n.hasAttribute("multiple"); r.addEventListener("click", () => n.click()), ["dragenter", "dragover"].forEach(e => r.addEventListener(e, e => { e.preventDefault(), r.classList.add("border-primary") })), ["dragleave", "drop"].forEach(e => r.addEventListener(e, e => { e.preventDefault(), r.classList.remove("border-primary") })), r.addEventListener("drop", e => { e.preventDefault(), s(e.dataTransfer.files) }), n.addEventListener("change", () => { s(n.files) }); function s(e) { d ? Array.from(e).forEach(e => l.push(e)) : (l = [e[0]], i.existingFiles = []), c() } function c() { if (o.innerHTML = "", 0 === l.length && 0 === i.existingFiles.length) a.style.display = "block", r.style.padding = "3rem"; else a.style.display = "none", r.style.padding = "0rem 1rem"; l.forEach((e, t) => { o.appendChild(u(e, t, !0)) }), i.existingFiles.forEach((e, t) => { const n = e.name || e.url.split("/").pop().split("?")[0].split("#")[0], a = { name: n, type: "", url: e.url }; o.appendChild(u(a, t, !1)) }), n.hasAttribute("required") && (0 === l.length && 0 === i.existingFiles.length ? n.setCustomValidity("Please upload a file.") : n.setCustomValidity("")) } function u(e, t, a) { const o = document.createElement("div"); o.className = "col-md-3"; const l = document.createElement("div"); l.className = "card position-relative shadow-sm"; const d = e.name || "file", s = d.split(".").pop().toLowerCase(); let c; if (["jpg", "jpeg", "png", "gif", "webp", "svg"].includes(s)) (c = document.createElement("img")).src = a ? URL.createObjectURL(e) : e.url, c.className = "card-img-top", c.style.height = i.previewHeight, c.style.objectFit = "cover"; else if ("pdf" === s) (c = document.createElement("iframe")).src = a ? URL.createObjectURL(e) : e.url, c.className = "card-img-top", c.style.height = i.previewHeight; else if (["mp4", "webm"].includes(s)) (c = document.createElement("video")).src = a ? URL.createObjectURL(e) : e.url, c.controls = !0, c.className = "card-img-top", c.style.height = i.previewHeight; else { c = document.createElement("div"), c.className = "d-flex flex-column justify-content-center align-items-center p-3 text-center"; const o = document.createElement("div"); o.innerHTML = m(s), o.style.height = i.previewHeight; const l = document.createElement("small"); l.className = "text-muted text-truncate w-100 d-block mt-2", l.textContent = d, c.appendChild(o), c.appendChild(l) } const f = document.createElement("button"); return f.type = "button", f.className = "btn btn-danger btn-sm position-absolute top-0 end-0 m-1", f.innerHTML = "&times;", f.onclick = e => { e.stopPropagation(), a ? l.splice(t, 1) : i.existingFiles.splice(t, 1), c() }, l.appendChild(c), l.appendChild(f), o.appendChild(l), o } function m(e) { const t = { doc: "#2B579A", docx: "#2B579A", xls: "#217346", xlsx: "#217346", ppt: "#D24726", pptx: "#D24726", pdf: "#D9381E", txt: "#5E5E5E", zip: "#8C8C8C", rar: "#8C8C8C", exe: "#444444", apk: "#25D366", default: "#888888" }[e] || "#888888"; return `<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" fill="${t}" viewBox="0 0 16 16"><path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6.5L9.5 0H4z"/><text x="8" y="12" text-anchor="middle" font-size="6" fill="white" font-family="Arial">${e.slice(0, 3).toUpperCase()}</text></svg>` } n._droperFiles = l, c() }, initAll: function (e = 'input[type="file"].droper') { document.querySelectorAll(e).forEach(e => { window.droper.init(e) }) } };
